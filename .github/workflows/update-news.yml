name: è‡ªå‹•ç”¢ç”Ÿæ–°è JSON

on:
  schedule:
    - cron: '0 * * * *'  # æ¯ 5 åˆ†é˜è·‘ä¸€æ¬¡ï¼ˆUTC æ™‚å€ï¼‰
  workflow_dispatch:        # å¯æ‰‹å‹•è§¸ç™¼

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ä¸‹è¼‰ repo
        uses: actions/checkout@v3

      - name: å®‰è£ Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: å®‰è£ä¾è³´ï¼ˆå¯è·³éï¼‰
        run: npm install || true

      - name: ç”¢ç”Ÿ news.json
        run: node generateNews.js

      - name: Commit ä¸¦æ¨å› GitHub
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add news.json
          git stash                          # âœ… æš«å­˜ä¿®æ”¹
          git pull origin main --rebase     # âœ… å…ˆæ‹‰æœ€æ–° main
          git stash pop                     # âœ… é‚„åŸä¿®æ”¹
          git add news.json                 # âœ… å†æ¬¡åŠ å…¥
          git commit -m "ğŸ“° è‡ªå‹•æ›´æ–°æ–°è $(date '+%Y-%m-%d %H:%M:%S')"
          git push
