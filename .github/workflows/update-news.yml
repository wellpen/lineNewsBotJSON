name: è‡ªå‹•ç”¢ç”Ÿæ–°è JSON

on:
  schedule:
    - cron: '0 22 * * *'  # å°ç£æ—©ä¸Š 6 é»
    - cron: '0 10 * * *'  # å°ç£æ™šä¸Š 6 é»
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}

    steps:
      - name: ä¸‹è¼‰ repo
        uses: actions/checkout@v3

      - name: å®‰è£ Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: å®‰è£ä¾è³´ï¼ˆå¯è·³éï¼‰
        run: npm install || true

      - name: ç”¢ç”Ÿ news.json
        run: node generateNews.js

      - name: Commit ä¸¦æ¨å› GitHubï¼ˆåªåœ¨æœ‰è®Šæ›´æ™‚ï¼‰
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add public/news.json
          git stash || true
          git pull origin main --rebase || true
          git stash pop || true
          git add public/news.json

          # âœ… åªåœ¨ news.json æœ‰è®ŠåŒ–æ™‚æ‰ commit + push
          if ! git diff --cached --quiet; then
            git commit -m "ğŸ“° è‡ªå‹•æ›´æ–°æ–°è $(date '+%Y-%m-%d %H:%M:%S')"
            git push
          else
            echo "ğŸ“­ æ²’æœ‰æª”æ¡ˆè®Šæ›´ï¼Œä¸æ¨é€ã€‚"
          fi
